<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
         <script type="text/javascript" src="cordova.js"></script>
         <script type="text/javascript" src="http://cdn.socket.io/socket.io-1.0.3.js"></script>
        <!-- // <script type="text/javascript" src="http://cdn.socket.io/socket.io-1.0.3.js"></script> -->
        <!-- // <script type="text/javascript" src="js/index.js"></script> -->
        <!-- // <script type="text/javascript" src="lib/socket.io.js"></script> -->
        <title>TestApp</title>

        <script >

var session;
var socket = io.connect("http://192.168.0.7:3000"); // I'm assuming that you know how to use socket.io
socket.on('messageReceived', onVideoMessageReceived);
socket.on('onMessage', function(message) {
session.receiveMessage(message);
});

function call(isInitiator) {
    var config = {
        isInitiator: isInitiator,
        turn: {
          // host: 'turn:ec2-54-68-238-149.us-west-2.compute.amazonaws.com:3478',
          // username: 'test',
          // password: 'test'
        host: 'turn:ec2-52-0-118-28.compute-1.amazonaws.com:3478',
          username: 'Dimelsa',
           password: '0602000210'
        },
        streams: {
            audio: true,
            video: true
        }
    };
    session = new cordova.plugins.phonertc.Session(config);
    cordova.plugins.phonertc.setVideoView({
        container: document.getElementById('videoContainer'),
        local: {
            position: [0, 0],
            size: [100, 100]
        }
    });
    session.on('sendMessage', function(data) {
        socket.emit('sendMessage', {
            type: 'phonertc_handshake',
            data: JSON.stringify(data)
        });
    });
    session.call();
}

function onVideoMessageReceived(message) {
    switch (message.type) {
        case 'call':
            $('#answer').show();
            break;
        case 'answer':
            call(true);
            break;
        case 'phonertc_handshake':
            // run this only once during the start of a call
            session.receiveMessage(JSON.parse(message.data));
            break;
    }
}

        </script>
<style>

        #videoContainer {
        width: 300px; 
    height: 300px; 
    background-color: #000;
    
}

 </style>

    </head>
    <body>

        <div class="chat">
            <div id="videoContainer"></div>
            <input type="button" value="Answer" id="answer" />
            <input type="button" value="Hangup" id="hangup" />
        </div>

        <p class="event listening">Connecting to Device</p>
  
    </body>
</html>
